<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="./css/menufonts.css">
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <link rel="stylesheet" href="datepicker.css">
    <style>
        a {
            color: whitesmoke !important;
        }
        
        label {
            display: none !important;
        }
        
        #personNumber,
        #range {
            color: whitesmoke !important;
            background-color: rgb(41, 41, 41);
            border: 1px, solid, goldenrod !important;
            margin: 10px;
            border-radius: 5px;
            width: 30vw;
        }
        
        .submitBtn {
            background-color: goldenrod;
            border-radius: 5px;
            color: whitesmoke !important;
            width: 30vw;
        }
    </style>
</head>

<body>
    <div class="logoDiv">
        <a href="index.html"><img src="https://warszawa.intercontinental.com/wp-content/themes/intercontinental/img/svg/logo.svg" alt="Nowoczesny hotel w sercu miasta – Hotel InterContinental Warszawa Centrum"></a>
    </div>
    <nav class="navbar navbar-expand-lg sticky-top largeNav">
        <div class="container-fluid">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
            <div class="collapse navbar-collapse justify-content-center" id="navbarNavAltMarkup">
                <div class="navbar-nav w-100 justify-content-around">
                    <a class="nav-link" href="index.html">Strona główna</a>
                    <a class="nav-link" href="rooms.html">Pokoje</a>
                    <a class="nav-link" href="gallery.html">Galeria</a>
                    <a class="nav-link" href="login.html">Konto</a>
                    <div style="background-color: goldenrod;padding-left: 15px; padding-right: 15px;"><a class="flex-sm-fill text-sm-center nav-link" href="reservation.html">Rezerwuj online</a></div>
                </div>
            </div>
        </div>
    </nav>


    <div class="rooms-banner  d-flex justify-content-center align-items-end">
        <h1>Zarezerwuj pokój</h1>

    </div>

    <div class="reservationDiv mt-5">
        <form>
            <label>Data przyjazdu:</label><input type="text" name="start-date" id="start-date" class="dateSelect">
            <label>Data odjazdu:</label><input type="text" name="end-date" id="end-date" class="dateSelect">
            <label>Ilość osób:</label><input type="number" name="persons" min="1" max="4">
            <input type="submit" style="background-color: goldenrod;padding-left: 15px; padding-right: 15px;" class="submitDate" value="Pokaż dostępne">
        </form>
    </div>

    <div class="container">

    </div>

    <footer class="mobileFooter">
        <div>
            ADRES <br> ul.Emilii Plater 49 <br> 00-125 Warszawa, Polska <br>
            <br> Telefon: +48 22 328 8888, <br> Fax: +48 22 328 8889 <br> Zarezerwuj online <br> lub zadzwoń: 00 800 121 5820 <br>
            <br> Email: warsaw@ihg.com<br> Konferencje i bankiety: wrs.convention@ihg.com<br>
            <br> Zameldowanie: 15:00<br> Wymeldowanie: 12:00<br>
        </div>
        <div style="padding-top: 20px; background-color: rgb(41, 41, 41);">
            Copyright © warszawa.intercontinental.com 2017. IHG. All rights reserved. This hotel is owned by WestInvest Gesellschaft für Investmentfonds mbH and is managed by InterContinental Hotels Group.
        </div>
    </footer>
    <nav class="nav justify-content-between fixed-bottom nav-pills mobileNav dropup">
        <button type="button" class="btn dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false" style="color:whitesmoke;">
            <i class="demo-icon icon-menu"></i>
          </button>
        <ul class="dropdown-menu dropdown-menu-dark w-100">
            <li><a href="login.html">Konto</a></li>
            <li><a href="rooms.html">Pokoje</a></li>
            <li><a href="gallery.html">Galeria</a></li>
            <li><a href="index.html">Strona główna</a></li>
        </ul>
        <a href="tel:+48223288888" class="flex-sm-fill text-sm-center nav-link"><i class="demo-icon icon-phone"></i></a>
        <div style="background-color: goldenrod;padding-left: 15px; padding-right: 15px;"><a class="flex-sm-fill text-sm-center nav-link" href="#">Rezerwuj online</a></div>

    </nav>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.6.3.min.js" integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.js" integrity="sha256-xLD7nhI62fcsEZK2/v8LsBcb4lG7dgULkuXoXB/j91c=" crossorigin="anonymous"></script>
    <script>
        let rooms;
        let start;
        let end;
        $(function() {

            $(document).on('click', '.reservationButton', function() {
                $('#myModal').modal('show');
            });

            function prepareData(dataToCode) {
                const dataPart = [];
                for (let key in dataToCode) {
                    dataPart.push(encodeURIComponent(key) + "=" + encodeURIComponent(dataToCode[key]));
                }
                return dataPart.join("&").replace(/%20/g, "+");
            }
            $("#start-date").datepicker({
                dateFormat: "yy-mm-dd",
                onSelect: function(date) {
                    // Ustawienie maxDate dla pierwszego datepickera
                    $("#end-date").datepicker("option", "minDate", date);
                }
            });
            $("#end-date").datepicker({
                dateFormat: "yy-mm-dd",
                onSelect: function(date) {
                    // Ustawienie maxDate dla pierwszego datepickera
                    $("#start-date").datepicker("option", "maxDate", date);
                }
            });
            $.getJSON("http://localhost:8000/getAllRooms", res => {
                console.log(res);
                rooms = res;
                $(rooms).each((i, e) => {
                    let $div = $("<div>", {
                        "class": "roomDiv mt-5 col",
                        "id": "room" + (i + 1)
                    });
                    let $textDiv = $("<div>", {
                        "class": "textDiv"
                    });
                    let $name = $("<h2>", {
                        "class": "roomName"
                    });
                    let $description = $("<p>", {
                        "class": "roomDescription"
                    });
                    $name.text(e.room_name);
                    $description.text(e.room_description);
                    let $photo = $("<img>", {
                        "class": "roomPhoto",
                        "src": "roomImages/zdj" + (i + 1) + ".jpg"
                    });
                    $div.append($photo);
                    $textDiv.append($name);
                    $textDiv.append($description);
                    $div.append($textDiv);
                    $('.container').append($div);
                })
            })

            $('form').submit(event => {
                event.preventDefault();
                $('.container').empty().html(`<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
                <div class="modal-content">
                    <div class="modal-header">
        <h5 class="modal-title">Modal title</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Modal body text goes here.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary">Save changes</button>
      </div>
                </div>
            </div>
        </div>`);



                const startdate = $("input[name=start-date]").val();
                const enddate = $("input[name=end-date]").val();
                const personscount = $("input[name=persons]").val();


                const Data = {
                    startDate: startdate,
                    endDate: enddate,
                    personsCount: personscount
                }

                const dataToSend = prepareData(Data);

                console.log(Data);

                $.ajax({
                    url: "http://localhost:8000/getFreeRooms",
                    method: "post",
                    contentType: "application/x-www-form-urlencoded",
                    data: dataToSend,
                    success(data) {
                        console.log(data);
                        rooms = data;
                        $(rooms).each((i, e) => {
                            let $div = $("<div>", {
                                "class": "roomDiv mt-5 col",
                                "id": e.room_id
                            });
                            let $textDiv = $("<div>", {
                                "class": "textDiv"
                            });
                            let $name = $("<h2>", {
                                "class": "roomName"
                            });
                            let $description = $("<p>", {
                                "class": "roomDescription"
                            });
                            let $button = $("<button>Zarezerwuj</button>", {
                                "class": "reservationButton",
                            }).prop({
                                'data-toggle': 'modal',
                                'data-target': '#myModal'
                            });
                            $name.text(e.room_name);
                            $description.text(e.room_description);
                            let $photo = $("<img>", {
                                "class": "roomPhoto",
                                "src": "roomImages/zdj" + (i + 1) + ".jpg"
                            });
                            $div.append($photo);
                            $textDiv.append($name);
                            $textDiv.append($description);
                            $textDiv.append($button);
                            $div.append($textDiv);
                            $('.container').append($div);
                        })
                    }
                }).done(res => {
                    start = startdate;
                    end = enddate;
                })

                $('.container').on('click', '.reservationButton', () => {
                    $('#myModal').modal('show');
                });

                $('#myModal').on('show.bs.modal', function(event) {
                    var button = $(event.relatedTarget);
                    //var name = button.data('name');
                    //var age = button.data('age');
                    var modal = $(this);
                    //modal.find('#name').text(name);
                    //modal.find('#age').text(age);
                })


            })
        })
    </script>

</body>

</html>